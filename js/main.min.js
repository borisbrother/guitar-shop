(()=>{"use strict";const e={products:document.querySelector("#products"),header:document.querySelector("#header"),shopping:document.querySelector("#shopping"),spinner:document.querySelector("#spinner"),error:document.querySelector("#error")},t=new class{constructor(){this.keyName="products",this.values=null!=localStorage.getItem(this.keyName)?JSON.parse(localStorage.getItem(this.keyName)):{},this.qty=this.countQty()}countQty(){let e=0;for(let t in this.values)e+=this.values[t];return e}getProducts(){return this.values}getQty(){return this.qty}saveProducts(){localStorage.setItem(this.keyName,JSON.stringify(this.values))}addProduct(e,t=1){this.qty+=t,this.values[e]=t,this.saveProducts()}deleteProduct(e){this.qty-=this.values[e],delete this.values[e],this.saveProducts()}switchProduct(e){let t;return e in this.values?(this.deleteProduct(e),t=!1):(this.addProduct(e),t=!0),{status:t,products:this.values}}};var n=!1;if("undefined"!=typeof window){var s={get passive(){n=!0}};window.addEventListener("testPassive",null,s),window.removeEventListener("testPassive",null,s)}var o="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),r=[],i=!1,a=-1,l=void 0,c=void 0,d=void 0,u=function(e){return r.some((function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))}))},p=function(e){var t=e||window.event;return!!u(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)},h=function(e){e?(r=r.filter((function(t){return t.targetElement!==e})),o&&(e.ontouchstart=null,e.ontouchmove=null,i&&0===r.length&&(document.removeEventListener("touchmove",p,n?{passive:!1}:void 0),i=!1)),o?function(){if(void 0!==c){var e=-parseInt(document.body.style.top,10),t=-parseInt(document.body.style.left,10);document.body.style.position=c.position,document.body.style.top=c.top,document.body.style.left=c.left,window.scrollTo(t,e),c=void 0}}():(void 0!==d&&(document.body.style.paddingRight=d,d=void 0),void 0!==l&&(document.body.style.overflow=l,l=void 0))):console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.")};class v extends Error{constructor(t){super(t),this.name="Fetch Error",this.el=e.error}render(){const e=`<div class="error__container">\n    <div class="error__icon"><img src="images/error-guitar.png"/></div>\n    <div class="error__caption">\n    <div class="error__message">\n    ${this.message}</div>\n    <div class="error__tip">Попробуйте зайти позже</div></div><div>\n    `;this.el.innerHTML=e,this.el.style.display="flex"}}let g=new class{async getCatalog(){let e=await fetch("http://myjson.dit.upm.es/api/bins/9g4s");if(!e.ok)throw new v("Ошибка подключения");try{return await e.json()}catch(e){throw new v("Некорректный ответ от сервера")}}};const m=new class{constructor(e){this.el=e}render(){this.el.innerHTML='<div class="spinner___icon"><img src="images/loader.svg"/></div>\n    <div class="spinner__logo">\n    <svg width="41.957275px" height="48px" viewBox="0 0 41.957275 48" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">\n  <g id="Group">\n    <path d="M0 14.3223C0 2.33443 8.56456 0.0537576 20.9227 0.000853621C33.2808 -0.0520504 41.9572 2.33443 41.9572 14.3223C41.9572 26.3101 28.201 48.0528 20.9227 47.9999C13.6444 47.947 0 26.3101 0 14.3223L0 14.3223Z" id="Vector" fill="#5D9CEC" fill-rule="evenodd" stroke="none" />\n    <path d="M11.2109 17.0075C11.2109 11.8169 15.4187 7.6091 20.6093 7.6091C25.7999 7.6091 30.0078 11.8169 30.0078 17.0075C30.0078 22.1981 25.7999 26.4059 20.6093 26.4059C15.4187 26.4059 11.2109 22.1981 11.2109 17.0075L11.2109 17.0075Z" id="Path-2" fill="#FFFFFF" fill-rule="evenodd" stroke="none" />\n    <path d="M23.0044 12.4592L18.6216 13.7999C18.09 13.951 17.66 14.5042 17.66 15.0358L17.66 19.5958C17.66 19.5958 17.66 19.6574 17.66 19.659C17.66 19.659 17.3426 19.4448 16.6352 19.5449C15.5966 19.6929 14.7536 20.4896 14.7536 21.3264C14.7536 22.1632 15.5966 22.6748 16.6352 22.5268C17.6754 22.3804 18.4367 21.6084 18.4367 20.7716C18.4367 20.7716 18.4367 17.1948 18.4367 16.8235C18.4367 16.4536 18.8821 16.2933 18.8821 16.2933L22.7578 15.079C22.7578 15.079 23.1862 14.9357 23.1862 15.3317C23.1862 15.7293 23.1862 18.5001 23.1862 18.5001C23.1862 18.5001 23.1862 18.5016 23.1862 18.5032C23.1862 18.5032 22.7917 18.2751 22.0844 18.3614C21.0457 18.4878 20.2028 19.2675 20.2028 20.1043C20.2028 20.9411 21.0457 21.4697 22.0844 21.3433C23.123 21.2185 23.966 20.4372 23.966 19.6004L23.966 13.145C23.966 12.6149 23.5345 12.3067 23.0044 12.4592L23.0044 12.4592Z" id="Shape" fill="#4A89DC" stroke="none" />\n    <path d="M12.8883 29.4268L28.3305 29.4268Q28.4075 29.4268 28.4831 29.4418Q28.5587 29.4569 28.6298 29.4864Q28.701 29.5158 28.7651 29.5586Q28.8291 29.6014 28.8836 29.6559Q28.9381 29.7104 28.9809 29.7744Q29.0237 29.8385 29.0532 29.9097Q29.0826 29.9809 29.0977 30.0564Q29.1127 30.132 29.1127 30.209L29.1127 30.211Q29.1127 30.2881 29.0977 30.3636Q29.0826 30.4392 29.0532 30.5103Q29.0237 30.5815 28.9809 30.6456Q28.9381 30.7096 28.8836 30.7641Q28.8291 30.8186 28.7651 30.8614Q28.701 30.9042 28.6298 30.9337Q28.5587 30.9632 28.4831 30.9782Q28.4075 30.9932 28.3305 30.9932L12.8883 30.9932Q12.8112 30.9932 12.7357 30.9782Q12.6601 30.9632 12.5889 30.9337Q12.5177 30.9042 12.4537 30.8614Q12.3896 30.8186 12.3352 30.7641Q12.2807 30.7096 12.2379 30.6456Q12.1951 30.5815 12.1656 30.5103Q12.1361 30.4392 12.1211 30.3636Q12.1061 30.2881 12.1061 30.211L12.1061 30.209Q12.1061 30.132 12.1211 30.0564Q12.1361 29.9809 12.1656 29.9097Q12.1951 29.8385 12.2379 29.7744Q12.2807 29.7104 12.3352 29.6559Q12.3896 29.6014 12.4537 29.5586Q12.5177 29.5158 12.5889 29.4864Q12.6601 29.4569 12.7357 29.4418Q12.8112 29.4268 12.8883 29.4268L12.8883 29.4268Z" id="Rectangle-3" fill="#4A89DC" fill-rule="evenodd" stroke="none" />\n    <path d="M12.8883 31.6645L28.3305 31.6645Q28.4075 31.6645 28.4831 31.6796Q28.5587 31.6946 28.6298 31.7241Q28.701 31.7536 28.7651 31.7964Q28.8291 31.8392 28.8836 31.8936Q28.9381 31.9481 28.9809 32.0122Q29.0237 32.0762 29.0532 32.1474Q29.0826 32.2186 29.0977 32.2941Q29.1127 32.3697 29.1127 32.4467L29.1127 32.4487Q29.1127 32.5258 29.0977 32.6013Q29.0826 32.6769 29.0532 32.7481Q29.0237 32.8192 28.9809 32.8833Q28.9381 32.9474 28.8836 33.0018Q28.8291 33.0563 28.7651 33.0991Q28.701 33.1419 28.6298 33.1714Q28.5587 33.2009 28.4831 33.2159Q28.4075 33.2309 28.3305 33.2309L12.8883 33.2309Q12.8112 33.2309 12.7357 33.2159Q12.6601 33.2009 12.5889 33.1714Q12.5177 33.1419 12.4537 33.0991Q12.3896 33.0563 12.3352 33.0018Q12.2807 32.9474 12.2379 32.8833Q12.1951 32.8192 12.1656 32.7481Q12.1361 32.6769 12.1211 32.6013Q12.1061 32.5258 12.1061 32.4487L12.1061 32.4467Q12.1061 32.3697 12.1211 32.2941Q12.1361 32.2186 12.1656 32.1474Q12.1951 32.0762 12.2379 32.0122Q12.2807 31.9481 12.3352 31.8936Q12.3896 31.8392 12.4537 31.7964Q12.5177 31.7536 12.5889 31.7241Q12.6601 31.6946 12.7357 31.6796Q12.8112 31.6645 12.8883 31.6645Z" id="Rectangle-3-Copy" fill="#4A89DC" fill-rule="evenodd" stroke="none" />\n    <path d="M16.6924 33.9023L24.7501 33.9023Q24.8272 33.9023 24.9027 33.9173Q24.9783 33.9323 25.0495 33.9618Q25.1206 33.9913 25.1847 34.0341Q25.2488 34.0769 25.3032 34.1314Q25.3577 34.1858 25.4005 34.2499Q25.4433 34.3139 25.4728 34.3851Q25.5023 34.4563 25.5173 34.5319Q25.5323 34.6074 25.5323 34.6845L25.5323 34.6865Q25.5323 34.7635 25.5173 34.8391Q25.5023 34.9146 25.4728 34.9858Q25.4433 35.057 25.4005 35.121Q25.3577 35.1851 25.3032 35.2396Q25.2488 35.294 25.1847 35.3368Q25.1206 35.3796 25.0495 35.4091Q24.9783 35.4386 24.9027 35.4536Q24.8272 35.4687 24.7501 35.4687L16.6924 35.4687Q16.6153 35.4687 16.5398 35.4536Q16.4642 35.4386 16.393 35.4091Q16.3218 35.3796 16.2578 35.3368Q16.1937 35.294 16.1393 35.2396Q16.0848 35.1851 16.042 35.121Q15.9992 35.057 15.9697 34.9858Q15.9402 34.9146 15.9252 34.8391Q15.9102 34.7635 15.9102 34.6865L15.9102 34.6845Q15.9102 34.6074 15.9252 34.5319Q15.9402 34.4563 15.9697 34.3851Q15.9992 34.3139 16.042 34.2499Q16.0848 34.1858 16.1393 34.1314Q16.1937 34.0769 16.2578 34.0341Q16.3218 33.9913 16.393 33.9618Q16.4642 33.9323 16.5398 33.9173Q16.6153 33.9023 16.6924 33.9023Z" id="Rectangle-3-Copy-2" fill="#4A89DC" fill-rule="evenodd" stroke="none" />\n  </g>\n</svg>\n    </div>\n    '}show(){h(this.el),this.el.classList.add("visible")}hide(){this.el.classList.remove("visible")}}(e.spinner);class y{constructor(e){this.el=e,this.productList={},this.indexID()}async indexID(){try{let e=await g.getCatalog();this.productList=e.reduce(((e,t)=>(e[[t.id]]=t,e)),{})}catch(e){console.log(e)}}static labels(){return{activeClassLabel:"active",addLabel:"Добавить в корзину",removeLabel:"Удалить из корзины"}}async render(){this.el.innerHTML="";const e=t.getProducts(),n=document.createElement("ul");n.classList.add("products__container");try{m.show();let t=await g.getCatalog();m.hide(),t.forEach((t=>{const s={activeClass:"",activeText:""};t.id in e?(s.activeClass=y.labels().activeClassLabel,s.activeText=y.labels().removeLabel):(s.activeClass="",s.activeText=y.labels().addLabel),n.appendChild(y.renderElementLi(t,s))})),this.el.appendChild(n)}catch(e){console.error(e.message),e.render(),m.hide()}}getProduct(e){return this.productList[e]}static renderElementLi({id:e,productName:n,price:s,img:o},r){const i=document.createElement("li");return i.classList.add("products__item"),i.innerHTML=`<div class="products__inner">\n      <span class="products__title">${n}</span>\n      <img src="${o}" alt="${n}" class="products__img">\n      <div class="products__footer">          \n        <div class="products__price">\n        <img src="images/plugin.png" class="products__icon">\n        ${s.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}\n        </div>\n        <button class="${r.activeClass}">${r.activeText}</button>\n      </div>\n    <div>`,i.querySelector("button").addEventListener("click",(n=>{let{status:s}=t.switchProduct(e);s?(n.target.classList.add(y.labels().activeClassLabel),n.target.innerHTML=`${y.labels().removeLabel}`):(n.target.classList.remove(y.labels().activeClassLabel),n.target.innerHTML=`${y.labels().addLabel}`),f.render()})),i}}const Q=new y(e.products);class _{constructor(e){this.el=e,this.el.addEventListener("click",(e=>{this.el.classList.remove("active"),document.body.classList.remove("lock"),Q.render(),h(document.body)}))}render(){this.el.innerHTML="";const e=document.createElement("ul");e.classList.add("shopping__container"),e.addEventListener("click",(e=>e.stopPropagation()));let n=1,s=0;const o=document.createElement("li");o.classList.add("shopping__element","shopping__element_header"),o.innerHTML='<span class="shopping__counter">№ п/п</span>\n    <span class="shopping__productName">Наименование продукта</span>\n    <span class="shopping__qty">Коли&shy;чество</span>\n    <span class="shopping__price">Цена</span>\n    <span class="shopping__button"></span>',e.appendChild(o),Object.keys(t.values).forEach((o=>{const r=Q.getProduct(o);if(!r)return;const i=t.values[o];e.appendChild(_.renderLi(n,r,i)),n++,s+=r.price}));const r=document.createElement("li");r.classList.add("shopping__element","shopping__element_footer"),r.innerHTML=`<span class="shopping__caption">Всего:</span>\n    <span class="shopping__total">${s.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}<span>`,e.appendChild(r),this.el.appendChild(e)}static renderLi(e,{id:n,productName:s,price:o},r){const i=document.createElement("li");return i.classList.add("shopping__element"),i.innerHTML=`<span class="shopping__counter">${e}</span>\n    <span class="shopping__productName">${s}</span>\n    <span class="shopping__qty">${r}</span>\n    <span class="shopping__price">${o.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}</span>\n    <span class="shopping__button"><button><img src="./images/cart-remove.svg"/></button></span>`,i.querySelector("button").addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),t.deleteProduct(n),console.log(Q),f.render(),i.style.opacity=0,setTimeout((()=>{L.render()}),200)})),i}}const L=new _(e.shopping),f=new class{constructor(e){this.el=e}render(){this.el.innerHTML="";const e=`<div class="header__container">        \n        <a href="#!" class="header__cart">\n            <img src="images/basket.svg" class="header__icon">\n            <span class="header__counter">${t.getQty()}</span>\n        </a>        \n    </div>`;this.el.innerHTML=e,this.el.querySelector(".header__cart").addEventListener("click",(e=>{e.preventDefault(),L.el.classList.add("active"),document.body.classList.add("lock"),function(e,t){if(e){if(!r.some((function(t){return t.targetElement===e}))){var s={targetElement:e,options:t||{}};r=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r),[s]),o?window.requestAnimationFrame((function(){if(void 0===c){c={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left};var e=window,t=e.scrollY,n=e.scrollX,s=e.innerHeight;document.body.style.position="fixed",document.body.style.top=-t,document.body.style.left=-n,setTimeout((function(){return window.requestAnimationFrame((function(){var e=s-window.innerHeight;e&&t>=s&&(document.body.style.top=-(t+e))}))}),300)}})):function(e){if(void 0===d){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;if(t&&n>0){var s=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right"),10);d=document.body.style.paddingRight,document.body.style.paddingRight=s+n+"px"}}void 0===l&&(l=document.body.style.overflow,document.body.style.overflow="hidden")}(t),o&&(e.ontouchstart=function(e){1===e.targetTouches.length&&(a=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-a;!u(e.target)&&(t&&0===t.scrollTop&&n>0||function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?p(e):e.stopPropagation())}(t,e)},i||(document.addEventListener("touchmove",p,n?{passive:!1}:void 0),i=!0))}}else console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.")}(document.body),L.render()}))}renderQty(){}}(e.header);Q.render(),f.render(),L.render(),m.render()})();