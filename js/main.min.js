(()=>{"use strict";const e=[{id:"el1",productName:"Cort G110-OPBK Электрогитара.",img:"https://i.ibb.co/6mw1JYB/guitar01.webp",price:18250},{id:"el2",productName:"Fender Squier Affinity 2021 Stratocaster MN Olympic White Электрогитара.",img:"https://i.ibb.co/wpgTLCL/guitar02.webp",price:45e3},{id:"el3",productName:"Ibanez Q52-LBM Безголовая электрогитара, цвет - насыщенный синий.",img:"https://i.ibb.co/hBBdJFY/guitar03.webp",price:108e3},{id:"el4",productName:"Homage HEG320SB Электрогитара.",img:"https://i.ibb.co/wsp99zL/guitar04.webp",price:9960.5},{id:"el5",productName:"Fender Squier Contemporary Stratocaster Special HT Pearl White Электрогитара.",img:"https://i.ibb.co/b70Q58j/guitar05.webp",price:61e3},{id:"el6",productName:"FGN J-Standard Iliad JIL2ASHM OWB Электрогитара.",img:"https://i.ibb.co/LdXfKJV/guitar06.webp",price:61e3},{id:"el7",productName:"Cort G110-OPBK Электрогитара.",img:"https://i.ibb.co/6mw1JYB/guitar01.webp",price:18250},{id:"el8",productName:"Fender Squier Affinity 2021 Stratocaster MN Olympic White Электрогитара.",img:"https://i.ibb.co/wpgTLCL/guitar02.webp",price:45e3},{id:"el9",productName:"Ibanez Q52-LBM Безголовая электрогитара, цвет - насыщенный синий.",img:"https://i.ibb.co/hBBdJFY/guitar03.webp",price:108e3},{id:"el10",productName:"Homage HEG320SB Электрогитара.",img:"https://i.ibb.co/wsp99zL/guitar04.webp",price:9960},{id:"el11",productName:"Fender Squier Contemporary Stratocaster Special HT Pearl White Электрогитара.",img:"https://i.ibb.co/b70Q58j/guitar05.webp",price:61e3},{id:"el12",productName:"FGN J-Standard Iliad JIL2ASHM OWB Электрогитара.",img:"https://i.ibb.co/LdXfKJV/guitar06.webp",price:61e3}],t={products:document.querySelector("#products"),header:document.querySelector("#header"),shopping:document.querySelector("#shopping")},n=new class{constructor(){this.keyName="products",this.values=null!=localStorage.getItem(this.keyName)?JSON.parse(localStorage.getItem(this.keyName)):{},this.qty=this.countQty()}countQty(){let e=0;for(let t in this.values)e+=this.values[t];return e}getProducts(){return this.values}getQty(){return this.qty}saveProducts(){localStorage.setItem(this.keyName,JSON.stringify(this.values))}addProduct(e,t=1){this.qty+=t,this.values[e]=t,this.saveProducts()}deleteProduct(e){this.qty-=this.values[e],delete this.values[e],this.saveProducts()}switchProduct(e){let t;return e in this.values?(this.deleteProduct(e),t=!1):(this.addProduct(e),t=!0),{status:t,products:this.values}}};class o{constructor(t){this.el=t,this.productList=e.reduce(((e,t)=>(e[[t.id]]=t,e)),{})}static labels(){return{activeClassLabel:"active",addLabel:"Добавить в корзину",removeLabel:"Удалить из корзины"}}render(){this.el.innerHTML="";const t=n.getProducts(),i=document.createElement("ul");i.classList.add("products__container"),e.forEach((e=>{const n={activeClass:"",activeText:""};e.id in t?(n.activeClass=o.labels().activeClassLabel,n.activeText=o.labels().removeLabel):(n.activeClass="",n.activeText=o.labels().addLabel),i.appendChild(o.renderElementLi(e,n))})),this.el.appendChild(i)}getProduct(e){return this.productList[e]}static renderElementLi({id:e,productName:t,price:i,img:s},r){const a=document.createElement("li");return a.classList.add("products__item"),a.innerHTML=`<div class="products__inner">\n      <span class="products__title">${t}</span>\n      <img src="${s}" alt="${t}" class="products__img">\n      <div class="products__footer">          \n        <div class="products__price">\n        <img src="images/plugin.png" class="products__icon">\n        ${i.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}\n        </div>\n        <button class="${r.activeClass}">${r.activeText}</button>\n      </div>\n    <div>`,a.querySelector("button").addEventListener("click",(t=>{let{status:i}=n.switchProduct(e);i?(t.target.classList.add(o.labels().activeClassLabel),t.target.innerHTML=`${o.labels().removeLabel}`):(t.target.classList.remove(o.labels().activeClassLabel),t.target.innerHTML=`${o.labels().addLabel}`),y.render()})),a}}const i=new o(t.products);var s=!1;if("undefined"!=typeof window){var r={get passive(){s=!0}};window.addEventListener("testPassive",null,r),window.removeEventListener("testPassive",null,r)}var a="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),c=[],d=!1,l=-1,u=void 0,p=void 0,m=void 0,h=function(e){return c.some((function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))}))},g=function(e){var t=e||window.event;return!!h(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)};class v{constructor(e){this.el=e,this.el.addEventListener("click",(e=>{var t;this.el.classList.remove("active"),document.body.classList.remove("lock"),(t=document.body)?(c=c.filter((function(e){return e.targetElement!==t})),a&&(t.ontouchstart=null,t.ontouchmove=null,d&&0===c.length&&(document.removeEventListener("touchmove",g,s?{passive:!1}:void 0),d=!1)),a?function(){if(void 0!==p){var e=-parseInt(document.body.style.top,10),t=-parseInt(document.body.style.left,10);document.body.style.position=p.position,document.body.style.top=p.top,document.body.style.left=p.left,window.scrollTo(t,e),p=void 0}}():(void 0!==m&&(document.body.style.paddingRight=m,m=void 0),void 0!==u&&(document.body.style.overflow=u,u=void 0))):console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.")}))}render(){this.el.innerHTML="";const e=document.createElement("ul");e.classList.add("shopping__container"),e.addEventListener("click",(e=>e.stopPropagation()));let t=1,o=0;const s=document.createElement("li");s.classList.add("shopping__element","shopping__element_header"),s.innerHTML='<span class="shopping__counter">№ п/п</span>\n    <span class="shopping__productName">Наименование продукта</span>\n    <span class="shopping__qty">Коли&shy;чество</span>\n    <span class="shopping__price">Цена</span>\n    <span class="shopping__button"></span>',e.appendChild(s),Object.keys(n.values).forEach((s=>{const r=i.getProduct(s),a=n.values[s];e.appendChild(v.renderLi(t,r,a)),t++,o+=r.price}));const r=document.createElement("li");r.classList.add("shopping__element","shopping__element_footer"),r.innerHTML=`<span class="shopping__caption">Всего:</span>\n    <span class="shopping__total">${o.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}<span>`,e.appendChild(r),this.el.appendChild(e)}static renderLi(e,{id:t,productName:o,price:s},r){const a=document.createElement("li");return a.classList.add("shopping__element"),a.innerHTML=`<span class="shopping__counter">${e}</span>\n    <span class="shopping__productName">${o}</span>\n    <span class="shopping__qty">${r}</span>\n    <span class="shopping__price">${s.toLocaleString("ru-RU",{style:"currency",currency:"RUR"})}</span>\n    <span class="shopping__button"><button><img src="./images/cart-remove.svg"/></button></span>`,a.querySelector("button").addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),n.deleteProduct(t),b.render(),console.log(i),i.render(),y.render()})),a}}const b=new v(t.shopping),y=new class{constructor(e){this.el=e}render(){this.el.innerHTML="";const e=`<div class="header__container">        \n        <a href="#!" class="header__cart">\n            <img src="images/basket.svg" class="header__icon">\n            <span class="header__counter">${n.getQty()}</span>\n        </a>        \n    </div>`;this.el.innerHTML=e,this.el.querySelector(".header__cart").addEventListener("click",(e=>{e.preventDefault(),b.el.classList.add("active"),document.body.classList.add("lock"),function(e,t){if(e){if(!c.some((function(t){return t.targetElement===e}))){var n={targetElement:e,options:t||{}};c=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(c),[n]),a?window.requestAnimationFrame((function(){if(void 0===p){p={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left};var e=window,t=e.scrollY,n=e.scrollX,o=e.innerHeight;document.body.style.position="fixed",document.body.style.top=-t,document.body.style.left=-n,setTimeout((function(){return window.requestAnimationFrame((function(){var e=o-window.innerHeight;e&&t>=o&&(document.body.style.top=-(t+e))}))}),300)}})):function(e){if(void 0===m){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;if(t&&n>0){var o=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right"),10);m=document.body.style.paddingRight,document.body.style.paddingRight=o+n+"px"}}void 0===u&&(u=document.body.style.overflow,document.body.style.overflow="hidden")}(t),a&&(e.ontouchstart=function(e){1===e.targetTouches.length&&(l=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-l;!h(e.target)&&(t&&0===t.scrollTop&&n>0||function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?g(e):e.stopPropagation())}(t,e)},d||(document.addEventListener("touchmove",g,s?{passive:!1}:void 0),d=!0))}}else console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.")}(document.body),b.render()}))}renderQty(){}}(t.header);i.render(),y.render(),b.render()})();